## TP 02 : Services, processus signaux

## 1 Secure Shell : SSH

### 1.1 Exercice : Connexion ssh root

Pour se connecter en root sur notre VM, on veut authoriser les connexion en root.
Dans le `man sshd_config` on trouve la liste des options que l'on peut configurer, celle qui nous intéresse ici est `PermitRootLogin`, qu'on va définir à `true`.
Cette option nous permettra de nous connecter en tant qu'administrateur, avec un mot de passe.

### 1.2 Exercice : Authentication par clef / Génération de clefs

Pour créer une clef d'authentification, on peut lire le `man ssh-keygen`.
`ssh-keygen` permet de générer des clefs, on y trouve l'option `-t` pour spécifier le type de clef que l'on veut générer.
Ici on fera:

```
ssh-keygen -t rsa
Generating public/private rsa key pair.
Enter file in which to save the key (/home/mimi/.ssh/id_rsa):
Enter passphrase for "/home/mimi/.ssh/id_rsa" (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/mimi/.ssh/id_rsa
Your public key has been saved in /home/mimi/.ssh/id_rsa.pub
```

On voit bien que la clef a été générée et qu'elle est sauvegardée dans un repertoire de mon utilisateur. Cette clef n'est faite que pour mon utilisateur courant `mimi`.

### 1.3 Exercice Authentication par clef / Connection serveur

On dépose note clef publique sur la VM dans `/root/.ssh/authorized_keys` grace à la commande `ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.174.15`.
Dans la VM on `chmod 600 /root/.ssh/authorized_keys` pour ne donner les droits de lecture et d'écriture qu'à root.
On en profite pour changer la config d'ssh dans `/etc/ssh/ssh_config` pour autoriser les connexion avec clef (`PubkeyAuthentication yes`).

### 1.4 Exercice : Authentification par clef : depuis la machine hote

Maintenant on peut se connecter :
`ssh -i .ssh/id_rsa.pub root@192.168.174.15`
On rentre notre passphrase et on peut se connecter maintenant sans mdp.

### 1.5 Exercice : Sécurisez

Les attaques de type brute-force ssh consistent à tester des combinaisons user/passwd en grand nombre pour trouver la bonne.
Pour éviter ce genre d'attaque, on peut désactiver la connexion par mot de passe de note serveur.
Pour cela on se rend dans notre configuration sshd de notre VM (`/etc/ssh/sshd_config`) et on desactive la connexion par mot de passe :
`PasswordAuthentication no`
De plus pour protéger root dans une VM avec d'autres utilisateurs, on peut empecher les connexions à root directement avec l'option:
`PermitRootLogin no`

Maintenant on ne peux plus se connecter, ni en tant que root et ni avec un mot de passe, il ne reste que la connexion à un utilisateur avec une clef ssh.
